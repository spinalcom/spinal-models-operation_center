"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _SpinalBIMObjectOC = require("./SpinalBIMObjectOC");

var _SpinalBIMObjectOC2 = _interopRequireDefault(_SpinalBIMObjectOC);

var _colors = require("../assets/utilities/colors");

var _colors2 = _interopRequireDefault(_colors);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const globalType = typeof window === "undefined" ? global : window;
const spinalCore = require("spinal-core-connectorjs");
const BIMForge = require("spinal-models-bim_forge");


let getViewer = function () {
  return globalType.v;
};

class SpinalBIMGroupOC extends BIMForge.SpinalBIMGroupForge {
  constructor(_parent, name = "SpinalBIMGroupOC") {
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        id: SpinalBIMGroupOC.SpinalBIMGroupOCId++,
        currentValue: 0,
        timeSeries: [],
        parent: _parent,
        active: false
      });
      this.display.set(true);
    }
  }

  populateTimeSeries() {
    let max = 30;
    if (this.timeSeries.length >= max) {
      this.timeSeries.shift();
      this.timeSeries.push(this.currentValue.get());
    } else {
      this.timeSeries.push(this.currentValue.get());
    }
  }

  refreshColors(_coloringType) {
    let newcolor = _colors2.default.colorByValue(this.currentValue.get(), 40, 90);
    this.color.set(newcolor);
    let dbids = this.arrayOfId();
    if (_coloringType === 1) {
      let opacity = 0.5;
      let colorRGB = _colors2.default.toRGB(this.color.get(), opacity);
      for (let index = 0; index < this.BIMObjects.length; index++) {
        getViewer().setThemingColor(this.BIMObjects[index].id.get(), colorRGB);
      }
    } else {
      getViewer().setColorMaterial(dbids, this.color.get());
    }
    return dbids;
  }

  contains(itemId) {
    return this.arrayOfId().indexOf(itemId) !== -1;
  }

  addItem(itemId) {
    if (!this.contains(itemId)) {
      let newBIMObject = new _SpinalBIMObjectOC2.default(itemId, this.id.get());
      newBIMObject.fillInfo().then(() => {
        this.BIMObjects.push(newBIMObject);
      });
    }
  }

  addItems(input, index) {
    // input is a list of BIMObjects to add
    if (typeof index === "undefined") {
      input.forEach(i => {
        if (this.BIMObjects.indexOf(i) === -1) {
          this.BIMObjects.push(i);
        }
      });
    } else {
      for (let i = 0; i < input.length; i++) {
        const element = input[i];
        if (!this.BIMObjects.contains(element)) {
          this.BIMObjects.insert(index + i, [element]);
        }
      }
    }
  }

  removeItems(input) {
    // input is a list of BIMObjects to be removed
    var removedItems = [];
    for (var i = 0; i < input.length; ++i) {
      var index = this.BIMObjects.indexOf(input[i]);
      if (index !== -1) {
        removedItems.push(this.BIMObjects[index].get());
        this.BIMObjects.splice(index, 1);
      }
    }
    return removedItems;
  }

  removeItemByIndex(index) {
    let toBeRemove = this.BIMObjects[index];
    this.BIMObjects.splice(index, 1);
    return toBeRemove;
  }

  arrayOfId() {
    let t = [];
    for (let i = 0; i < this.BIMObjects.length; i++) {
      const item = this.BIMObjects[i];
      t.push(item.id.get());
    }
    return t;
  }

  isolate() {
    getViewer().isolateById(this.arrayOfId());
  }

  setCurrentValue(_value) {
    this.currentValue.set(_value);
    this.populateTimeSeries();
  }

}
exports.default = SpinalBIMGroupOC;
SpinalBIMGroupOC.SpinalBIMGroupOCId = 0;

spinalCore.register_models([SpinalBIMGroupOC]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxCSU1Hcm91cE9DLmpzIl0sIm5hbWVzIjpbImdsb2JhbFR5cGUiLCJ3aW5kb3ciLCJnbG9iYWwiLCJzcGluYWxDb3JlIiwicmVxdWlyZSIsIkJJTUZvcmdlIiwiZ2V0Vmlld2VyIiwidiIsIlNwaW5hbEJJTUdyb3VwT0MiLCJTcGluYWxCSU1Hcm91cEZvcmdlIiwiY29uc3RydWN0b3IiLCJfcGFyZW50IiwibmFtZSIsIkZpbGVTeXN0ZW0iLCJfc2lnX3NlcnZlciIsImFkZF9hdHRyIiwiaWQiLCJTcGluYWxCSU1Hcm91cE9DSWQiLCJjdXJyZW50VmFsdWUiLCJ0aW1lU2VyaWVzIiwicGFyZW50IiwiYWN0aXZlIiwiZGlzcGxheSIsInNldCIsInBvcHVsYXRlVGltZVNlcmllcyIsIm1heCIsImxlbmd0aCIsInNoaWZ0IiwicHVzaCIsImdldCIsInJlZnJlc2hDb2xvcnMiLCJfY29sb3JpbmdUeXBlIiwibmV3Y29sb3IiLCJjb2xvcnMiLCJjb2xvckJ5VmFsdWUiLCJjb2xvciIsImRiaWRzIiwiYXJyYXlPZklkIiwib3BhY2l0eSIsImNvbG9yUkdCIiwidG9SR0IiLCJpbmRleCIsIkJJTU9iamVjdHMiLCJzZXRUaGVtaW5nQ29sb3IiLCJzZXRDb2xvck1hdGVyaWFsIiwiY29udGFpbnMiLCJpdGVtSWQiLCJpbmRleE9mIiwiYWRkSXRlbSIsIm5ld0JJTU9iamVjdCIsIlNwaW5hbEJJTU9iamVjdE9DIiwiZmlsbEluZm8iLCJ0aGVuIiwiYWRkSXRlbXMiLCJpbnB1dCIsImZvckVhY2giLCJpIiwiZWxlbWVudCIsImluc2VydCIsInJlbW92ZUl0ZW1zIiwicmVtb3ZlZEl0ZW1zIiwic3BsaWNlIiwicmVtb3ZlSXRlbUJ5SW5kZXgiLCJ0b0JlUmVtb3ZlIiwidCIsIml0ZW0iLCJpc29sYXRlIiwiaXNvbGF0ZUJ5SWQiLCJzZXRDdXJyZW50VmFsdWUiLCJfdmFsdWUiLCJyZWdpc3Rlcl9tb2RlbHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUdB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S0FBS3JCLFVBQUwsQ0FBZ0JELEtBQWhCLENBQWpCO0FBQ0EsU0FBS0MsVUFBTCxDQUFnQm1CLE1BQWhCLENBQXVCcEIsS0FBdkIsRUFBOEIsQ0FBOUI7QUFDQSxXQUFPc0IsVUFBUDtBQUNEOztBQUVEMUIsY0FBWTtBQUNWLFFBQUkyQixJQUFJLEVBQVI7QUFDQSxTQUFLLElBQUlSLElBQUksQ0FBYixFQUFnQkEsSUFBSSxLQUFLZCxVQUFMLENBQWdCaEIsTUFBcEMsRUFBNEM4QixHQUE1QyxFQUFpRDtBQUMvQyxZQUFNUyxPQUFPLEtBQUt2QixVQUFMLENBQWdCYyxDQUFoQixDQUFiO0FBQ0FRLFFBQUVwQyxJQUFGLENBQU9xQyxLQUFLakQsRUFBTCxDQUFRYSxHQUFSLEVBQVA7QUFDRDtBQUNELFdBQU9tQyxDQUFQO0FBQ0Q7O0FBRURFLFlBQVU7QUFDUjVELGdCQUFZNkQsV0FBWixDQUF3QixLQUFLOUIsU0FBTCxFQUF4QjtBQUNEOztBQUVEK0Isa0JBQWdCQyxNQUFoQixFQUF3QjtBQUN0QixTQUFLbkQsWUFBTCxDQUFrQkssR0FBbEIsQ0FBc0I4QyxNQUF0QjtBQUNBLFNBQUs3QyxrQkFBTDtBQUNEOztBQWpId0U7a0JBQXREaEIsZ0I7QUFxSHJCQSxpQkFBaUJTLGtCQUFqQixHQUFzQyxDQUF0Qzs7QUFFQWQsV0FBV21FLGVBQVgsQ0FBMkIsQ0FBQzlELGdCQUFELENBQTNCIiwiZmlsZSI6IlNwaW5hbEJJTUdyb3VwT0MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnbG9iYWxUeXBlID0gdHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbCA6IHdpbmRvdztcbmNvbnN0IHNwaW5hbENvcmUgPSByZXF1aXJlKFwic3BpbmFsLWNvcmUtY29ubmVjdG9yanNcIik7XG5jb25zdCBCSU1Gb3JnZSA9IHJlcXVpcmUoXCJzcGluYWwtbW9kZWxzLWJpbV9mb3JnZVwiKTtcbmltcG9ydCBTcGluYWxCSU1PYmplY3RPQyBmcm9tIFwiLi9TcGluYWxCSU1PYmplY3RPQ1wiXG5pbXBvcnQgY29sb3JzIGZyb20gXCIuLi9hc3NldHMvdXRpbGl0aWVzL2NvbG9yc1wiXG5cblxubGV0IGdldFZpZXdlciA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gZ2xvYmFsVHlwZS52O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTcGluYWxCSU1Hcm91cE9DIGV4dGVuZHMgQklNRm9yZ2UuU3BpbmFsQklNR3JvdXBGb3JnZSB7XG4gIGNvbnN0cnVjdG9yKF9wYXJlbnQsIG5hbWUgPSBcIlNwaW5hbEJJTUdyb3VwT0NcIikge1xuICAgIHN1cGVyKCk7XG4gICAgaWYgKEZpbGVTeXN0ZW0uX3NpZ19zZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYWRkX2F0dHIoe1xuICAgICAgICBpZDogU3BpbmFsQklNR3JvdXBPQy5TcGluYWxCSU1Hcm91cE9DSWQrKyxcbiAgICAgICAgY3VycmVudFZhbHVlOiAwLFxuICAgICAgICB0aW1lU2VyaWVzOiBbXSxcbiAgICAgICAgcGFyZW50OiBfcGFyZW50LFxuICAgICAgICBhY3RpdmU6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZGlzcGxheS5zZXQodHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgcG9wdWxhdGVUaW1lU2VyaWVzKCkge1xuICAgIGxldCBtYXggPSAzMDtcbiAgICBpZiAodGhpcy50aW1lU2VyaWVzLmxlbmd0aCA+PSBtYXgpIHtcbiAgICAgIHRoaXMudGltZVNlcmllcy5zaGlmdCgpO1xuICAgICAgdGhpcy50aW1lU2VyaWVzLnB1c2godGhpcy5jdXJyZW50VmFsdWUuZ2V0KCkpXG5cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50aW1lU2VyaWVzLnB1c2godGhpcy5jdXJyZW50VmFsdWUuZ2V0KCkpXG4gICAgfVxuICB9XG5cbiAgcmVmcmVzaENvbG9ycyhfY29sb3JpbmdUeXBlKSB7XG4gICAgbGV0IG5ld2NvbG9yID0gY29sb3JzLmNvbG9yQnlWYWx1ZSh0aGlzLmN1cnJlbnRWYWx1ZS5nZXQoKSwgNDAsIDkwKVxuICAgIHRoaXMuY29sb3Iuc2V0KG5ld2NvbG9yKTtcbiAgICBsZXQgZGJpZHMgPSB0aGlzLmFycmF5T2ZJZCgpO1xuICAgIGlmIChfY29sb3JpbmdUeXBlID09PSAxKSB7XG4gICAgICBsZXQgb3BhY2l0eSA9IDAuNVxuICAgICAgbGV0IGNvbG9yUkdCID0gY29sb3JzLnRvUkdCKHRoaXMuY29sb3IuZ2V0KCksIG9wYWNpdHkpXG4gICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5CSU1PYmplY3RzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICBnZXRWaWV3ZXIoKS5zZXRUaGVtaW5nQ29sb3IodGhpcy5CSU1PYmplY3RzW2luZGV4XS5pZC5nZXQoKSxcbiAgICAgICAgICBjb2xvclJHQik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGdldFZpZXdlcigpLnNldENvbG9yTWF0ZXJpYWwoZGJpZHMsIHRoaXMuY29sb3IuZ2V0KCkpO1xuICAgIH1cbiAgICByZXR1cm4gZGJpZHM7XG4gIH1cblxuICBjb250YWlucyhpdGVtSWQpIHtcbiAgICByZXR1cm4gdGhpcy5hcnJheU9mSWQoKS5pbmRleE9mKGl0ZW1JZCkgIT09IC0xO1xuICB9XG5cblxuXG4gIGFkZEl0ZW0oaXRlbUlkKSB7XG4gICAgaWYgKCF0aGlzLmNvbnRhaW5zKGl0ZW1JZCkpIHtcbiAgICAgIGxldCBuZXdCSU1PYmplY3QgPSBuZXcgU3BpbmFsQklNT2JqZWN0T0MoaXRlbUlkLCB0aGlzLmlkLmdldCgpKTtcbiAgICAgIG5ld0JJTU9iamVjdC5maWxsSW5mbygpLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLkJJTU9iamVjdHMucHVzaChuZXdCSU1PYmplY3QpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cblxuXG4gIGFkZEl0ZW1zKGlucHV0LCBpbmRleCkge1xuICAgIC8vIGlucHV0IGlzIGEgbGlzdCBvZiBCSU1PYmplY3RzIHRvIGFkZFxuICAgIGlmICh0eXBlb2YgaW5kZXggPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGlucHV0LmZvckVhY2goaSA9PiB7XG4gICAgICAgIGlmICh0aGlzLkJJTU9iamVjdHMuaW5kZXhPZihpKSA9PT0gLTEpIHtcbiAgICAgICAgICB0aGlzLkJJTU9iamVjdHMucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGlucHV0W2ldO1xuICAgICAgICBpZiAoIXRoaXMuQklNT2JqZWN0cy5jb250YWlucyhlbGVtZW50KSkge1xuICAgICAgICAgIHRoaXMuQklNT2JqZWN0cy5pbnNlcnQoaW5kZXggKyBpLCBbZWxlbWVudF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlSXRlbXMoaW5wdXQpIHtcbiAgICAvLyBpbnB1dCBpcyBhIGxpc3Qgb2YgQklNT2JqZWN0cyB0byBiZSByZW1vdmVkXG4gICAgdmFyIHJlbW92ZWRJdGVtcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBpbmRleCA9IHRoaXMuQklNT2JqZWN0cy5pbmRleE9mKGlucHV0W2ldKTtcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgcmVtb3ZlZEl0ZW1zLnB1c2godGhpcy5CSU1PYmplY3RzW2luZGV4XS5nZXQoKSk7XG4gICAgICAgIHRoaXMuQklNT2JqZWN0cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVtb3ZlZEl0ZW1zO1xuICB9XG5cbiAgcmVtb3ZlSXRlbUJ5SW5kZXgoaW5kZXgpIHtcbiAgICBsZXQgdG9CZVJlbW92ZSA9IHRoaXMuQklNT2JqZWN0c1tpbmRleF1cbiAgICB0aGlzLkJJTU9iamVjdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICByZXR1cm4gdG9CZVJlbW92ZTtcbiAgfVxuXG4gIGFycmF5T2ZJZCgpIHtcbiAgICBsZXQgdCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5CSU1PYmplY3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBpdGVtID0gdGhpcy5CSU1PYmplY3RzW2ldO1xuICAgICAgdC5wdXNoKGl0ZW0uaWQuZ2V0KCkpO1xuICAgIH1cbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIGlzb2xhdGUoKSB7XG4gICAgZ2V0Vmlld2VyKCkuaXNvbGF0ZUJ5SWQodGhpcy5hcnJheU9mSWQoKSk7XG4gIH1cblxuICBzZXRDdXJyZW50VmFsdWUoX3ZhbHVlKSB7XG4gICAgdGhpcy5jdXJyZW50VmFsdWUuc2V0KF92YWx1ZSlcbiAgICB0aGlzLnBvcHVsYXRlVGltZVNlcmllcygpO1xuICB9XG5cblxufVxuU3BpbmFsQklNR3JvdXBPQy5TcGluYWxCSU1Hcm91cE9DSWQgPSAwXG5cbnNwaW5hbENvcmUucmVnaXN0ZXJfbW9kZWxzKFtTcGluYWxCSU1Hcm91cE9DXSkiXX0=