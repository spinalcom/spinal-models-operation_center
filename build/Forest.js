"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _ConfigurationNode = require("./ConfigurationNode");

var _ConfigurationNode2 = _interopRequireDefault(_ConfigurationNode);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const spinalCore = require("spinal-core-connectorjs");
const globalType = typeof window === "undefined" ? global : window;

let getViewer = function () {
  return globalType.v;
};
class Forest extends globalType.Model {
  constructor(_options) {
    if (typeof _options === "undefined") _options = new globalType.Model();
    super();
    if (FileSystem._sig_server) {
      this.add_attr({
        list: new Lst(),
        childNameId: 0,
        coloringType: 0,
        relOptions: _options
      });
    }
  }

  incrementChildNameId() {
    this.childNameId.set(this.childNameId.get() + 1);
    return this.childNameId.get();
  }

  addTree(title) {
    var tree = new _ConfigurationNode2.default(0, "Zone", this.relOptions);
    let id = this.incrementChildNameId();
    tree.setTitle(title + " " + id.toString());

    this.list.push(tree);
  }

  removeTree(root) {
    let i = this.list.indexOf(root);
    if (i >= 0) {
      this.list.splice(i, 1);
      delete FileSystem._objects[root._server_id];
    }
    return i;
  }

  getEquipements() {
    let equipementsArray = [];
    for (let i = 0; i < this.list.length; i++) {
      const tree = this.list[i];
      equipementsArray = equipementsArray.concat(tree.getEquipements());
    }
    return equipementsArray;
  }

  getAllBIMGroups() {
    let res = [];
    for (let i = 0; i < this.list.length; i++) {
      const tree = this.list[i];
      res = res.concat(tree.getAllBIMGroups());
    }
    return res;
  }

  getAllBIMObjectsIds() {
    let res = [];
    let BIMGroups = this.getAllBIMGroups();
    for (let index = 0; index < BIMGroups.length; index++) {
      const element = BIMGroups[index];
      res = res.concat(element.arrayOfId());
    }
    return res;
  }

  restoreColorMaterial() {
    if (this.coloringType === 1) getViewer().clearThemingColors();else {
      getViewer().restoreColorMaterial(this.getAllBIMObjectsIds());
    }
  }

  refreshAllColors() {
    let BIMGroups = this.getAllBIMGroups();
    for (let index = 0; index < BIMGroups.length; index++) {
      const element = BIMGroups[index];
      if (element.currentValue.get() !== 0 && element.display.get()) {
        element.refreshColors(this.coloringType);
      }
    }
  }

  activateAllBIMGroups() {
    let t = this.getAllBIMGroups();
    for (let index = 0; index < t.length; index++) {
      const element = t[index];
      element.active.set(true);
    }
  }

  disactivateAllBIMGroups() {
    let t = this.getAllBIMGroups();
    for (let index = 0; index < t.length; index++) {
      const element = t[index];
      element.active.set(false);
    }
  }
}

exports.default = Forest;
spinalCore.register_models([Forest]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Gb3Jlc3QuanMiXSwibmFtZXMiOlsic3BpbmFsQ29yZSIsInJlcXVpcmUiLCJnbG9iYWxUeXBlIiwid2luZG93IiwiZ2xvYmFsIiwiZ2V0Vmlld2VyIiwidiIsIkZvcmVzdCIsIk1vZGVsIiwiY29uc3RydWN0b3IiLCJfb3B0aW9ucyIsIkZpbGVTeXN0ZW0iLCJfc2lnX3NlcnZlciIsImFkZF9hdHRyIiwibGlzdCIsIkxzdCIsImNoaWxkTmFtZUlkIiwiY29sb3JpbmdUeXBlIiwicmVsT3B0aW9ucyIsImluY3JlbWVudENoaWxkTmFtZUlkIiwic2V0IiwiZ2V0IiwiYWRkVHJlZSIsInRpdGxlIiwidHJlZSIsIkNvbmZpZ3VyYXRpb25Ob2RlIiwiaWQiLCJzZXRUaXRsZSIsInRvU3RyaW5nIiwicHVzaCIsInJlbW92ZVRyZWUiLCJyb290IiwiaSIsImluZGV4T2YiLCJzcGxpY2UiLCJfb2JqZWN0cyIsIl9zZXJ2ZXJfaWQiLCJnZXRFcXVpcGVtZW50cyIsImVxdWlwZW1lbnRzQXJyYXkiLCJsZW5ndGgiLCJjb25jYXQiLCJnZXRBbGxCSU1Hcm91cHMiLCJyZXMiLCJnZXRBbGxCSU1PYmplY3RzSWRzIiwiQklNR3JvdXBzIiwiaW5kZXgiLCJlbGVtZW50IiwiYXJyYXlPZklkIiwicmVzdG9yZUNvbG9yTWF0ZXJpYWwiLCJjbGVhclRoZW1pbmdDb2xvcnMiLCJyZWZyZXNoQWxsQ29sb3JzIiwiY3VycmVudFZhbHVlIiwiZGlzcGxheSIsInJlZnJlc2hDb2xvcnMiLCJhY3RpdmF0ZUFsbEJJTUdyb3VwcyIsInQiLCJhY3RpdmUiLCJkaXNhY3RpdmF0ZUFsbEJJTUdyb3VwcyIsInJlZ2lzdGVyX21vZGVscyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBRUE7Ozs7OztBQUZBLE1BQU1BLGFBQWFDLFFBQVEseUJBQVIsQ0FBbkI7QUFDQSxNQUFNQyxhQUFhLE9BQU9DLE1BQVAsS0FBa0IsV0FBbEIsR0FBZ0NDLE1BQWhDLEdBQXlDRCxNQUE1RDs7QUFFQSxJ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RDtBQUNGOztBQUVETyxxQkFBbUI7QUFDakIsUUFBSU4sWUFBWSxLQUFLSCxlQUFMLEVBQWhCO0FBQ0EsU0FBSyxJQUFJSSxRQUFRLENBQWpCLEVBQW9CQSxRQUFRRCxVQUFVTCxNQUF0QyxFQUE4Q00sT0FBOUMsRUFBdUQ7QUFDckQsWUFBTUMsVUFBVUYsVUFBVUMsS0FBVixDQUFoQjtBQUNBLFVBQUlDLFFBQVFLLFlBQVIsQ0FBcUI5QixHQUFyQixPQUErQixDQUEvQixJQUFvQ3lCLFFBQVFNLE9BQVIsQ0FBZ0IvQixHQUFoQixFQUF4QyxFQUErRDtBQUM3RHlCLGdCQUFRTyxhQUFSLENBQXNCLEtBQUtwQyxZQUEzQjtBQUNEO0FBQ0Y7QUFDRjs7QUFFRHFDLHlCQUF1QjtBQUNyQixRQUFJQyxJQUFJLEtBQUtkLGVBQUwsRUFBUjtBQUNBLFNBQUssSUFBSUksUUFBUSxDQUFqQixFQUFvQkEsUUFBUVUsRUFBRWhCLE1BQTlCLEVBQXNDTSxPQUF0QyxFQUErQztBQUM3QyxZQUFNQyxVQUFVUyxFQUFFVixLQUFGLENBQWhCO0FBQ0FDLGNBQVFVLE1BQVIsQ0FBZXBDLEdBQWYsQ0FBbUIsSUFBbkI7QUFDRDtBQUNGOztBQUVEcUMsNEJBQTBCO0FBQ3hCLFFBQUlGLElBQUksS0FBS2QsZUFBTCxFQUFSO0FBQ0EsU0FBSyxJQUFJSSxRQUFRLENBQWpCLEVBQW9CQSxRQUFRVSxFQUFFaEIsTUFBOUIsRUFBc0NNLE9BQXRDLEVBQStDO0FBQzdDLFlBQU1DLFVBQVVTLEVBQUVWLEtBQUYsQ0FBaEI7QUFDQUMsY0FBUVUsTUFBUixDQUFlcEMsR0FBZixDQUFtQixLQUFuQjtBQUNEO0FBQ0Y7QUEvRmtEOztrQkFBaENiLE07QUFrR3JCUCxXQUFXMEQsZUFBWCxDQUEyQixDQUFDbkQsTUFBRCxDQUEzQiIsImZpbGUiOiJGb3Jlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzcGluYWxDb3JlID0gcmVxdWlyZShcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzXCIpO1xuY29uc3QgZ2xvYmFsVHlwZSA9IHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWwgOiB3aW5kb3c7XG5pbXBvcnQgQ29uZmlndXJhdGlvbk5vZGUgZnJvbSBcIi4vQ29uZmlndXJhdGlvbk5vZGVcIlxubGV0IGdldFZpZXdlciA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gZ2xvYmFsVHlwZS52O1xufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9yZXN0IGV4dGVuZHMgZ2xvYmFsVHlwZS5Nb2RlbCB7XG4gIGNvbnN0cnVjdG9yKF9vcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBfb3B0aW9ucyA9PT0gXCJ1bmRlZmluZWRcIikgX29wdGlvbnMgPSBuZXcgZ2xvYmFsVHlwZS5Nb2RlbCgpXG4gICAgc3VwZXIoKTtcbiAgICBpZiAoRmlsZVN5c3RlbS5fc2lnX3NlcnZlcikge1xuICAgICAgdGhpcy5hZGRfYXR0cih7XG4gICAgICAgIGxpc3Q6IG5ldyBMc3QoKSxcbiAgICAgICAgY2hpbGROYW1lSWQ6IDAsXG4gICAgICAgIGNvbG9yaW5nVHlwZTogMCxcbiAgICAgICAgcmVsT3B0aW9uczogX29wdGlvbnNcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGluY3JlbWVudENoaWxkTmFtZUlkKCkge1xuICAgIHRoaXMuY2hpbGROYW1lSWQuc2V0KHRoaXMuY2hpbGROYW1lSWQuZ2V0KCkgKyAxKTtcbiAgICByZXR1cm4gdGhpcy5jaGlsZE5hbWVJZC5nZXQoKTtcbiAgfVxuXG4gIGFkZFRyZWUodGl0bGUpIHtcbiAgICB2YXIgdHJlZSA9IG5ldyBDb25maWd1cmF0aW9uTm9kZSgwLCBcIlpvbmVcIiwgdGhpcy5yZWxPcHRpb25zKTtcbiAgICBsZXQgaWQgPSB0aGlzLmluY3JlbWVudENoaWxkTmFtZUlkKClcbiAgICB0cmVlLnNldFRpdGxlKHRpdGxlICsgXCIgXCIgKyBpZC50b1N0cmluZygpKTtcblxuICAgIHRoaXMubGlzdC5wdXNoKHRyZWUpO1xuICB9XG5cbiAgcmVtb3ZlVHJlZShyb290KSB7XG4gICAgbGV0IGkgPSB0aGlzLmxpc3QuaW5kZXhPZihyb290KTtcbiAgICBpZiAoaSA+PSAwKSB7XG4gICAgICB0aGlzLmxpc3Quc3BsaWNlKGksIDEpO1xuICAgICAgZGVsZXRlIEZpbGVTeXN0ZW0uX29iamVjdHNbcm9vdC5fc2VydmVyX2lkXTtcbiAgICB9XG4gICAgcmV0dXJuIGk7XG4gIH1cblxuICBnZXRFcXVpcGVtZW50cygpIHtcbiAgICBsZXQgZXF1aXBlbWVudHNBcnJheSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5saXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0cmVlID0gdGhpcy5saXN0W2ldO1xuICAgICAgZXF1aXBlbWVudHNBcnJheSA9IGVxdWlwZW1lbnRzQXJyYXkuY29uY2F0KHRyZWUuZ2V0RXF1aXBlbWVudHMoKSk7XG4gICAgfVxuICAgIHJldHVybiBlcXVpcGVtZW50c0FycmF5O1xuICB9XG5cbiAgZ2V0QWxsQklNR3JvdXBzKCkge1xuICAgIGxldCByZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdHJlZSA9IHRoaXMubGlzdFtpXTtcbiAgICAgIHJlcyA9IHJlcy5jb25jYXQodHJlZS5nZXRBbGxCSU1Hcm91cHMoKSk7XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBnZXRBbGxCSU1PYmplY3RzSWRzKCkge1xuICAgIGxldCByZXMgPSBbXVxuICAgIGxldCBCSU1Hcm91cHMgPSB0aGlzLmdldEFsbEJJTUdyb3VwcygpO1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBCSU1Hcm91cHMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBlbGVtZW50ID0gQklNR3JvdXBzW2luZGV4XTtcbiAgICAgIHJlcyA9IHJlcy5jb25jYXQoZWxlbWVudC5hcnJheU9mSWQoKSlcbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIHJlc3RvcmVDb2xvck1hdGVyaWFsKCkge1xuICAgIGlmICh0aGlzLmNvbG9yaW5nVHlwZSA9PT0gMSkgZ2V0Vmlld2VyKCkuY2xlYXJUaGVtaW5nQ29sb3JzKClcbiAgICBlbHNlIHtcbiAgICAgIGdldFZpZXdlcigpLnJlc3RvcmVDb2xvck1hdGVyaWFsKHRoaXMuZ2V0QWxsQklNT2JqZWN0c0lkcygpKVxuICAgIH1cbiAgfVxuXG4gIHJlZnJlc2hBbGxDb2xvcnMoKSB7XG4gICAgbGV0IEJJTUdyb3VwcyA9IHRoaXMuZ2V0QWxsQklNR3JvdXBzKCk7XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IEJJTUdyb3Vwcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBCSU1Hcm91cHNbaW5kZXhdO1xuICAgICAgaWYgKGVsZW1lbnQuY3VycmVudFZhbHVlLmdldCgpICE9PSAwICYmIGVsZW1lbnQuZGlzcGxheS5nZXQoKSkge1xuICAgICAgICBlbGVtZW50LnJlZnJlc2hDb2xvcnModGhpcy5jb2xvcmluZ1R5cGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFjdGl2YXRlQWxsQklNR3JvdXBzKCkge1xuICAgIGxldCB0ID0gdGhpcy5nZXRBbGxCSU1Hcm91cHMoKVxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRbaW5kZXhdO1xuICAgICAgZWxlbWVudC5hY3RpdmUuc2V0KHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIGRpc2FjdGl2YXRlQWxsQklNR3JvdXBzKCkge1xuICAgIGxldCB0ID0gdGhpcy5nZXRBbGxCSU1Hcm91cHMoKVxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0Lmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY29uc3QgZWxlbWVudCA9IHRbaW5kZXhdO1xuICAgICAgZWxlbWVudC5hY3RpdmUuc2V0KGZhbHNlKTtcbiAgICB9XG4gIH1cbn1cblxuc3BpbmFsQ29yZS5yZWdpc3Rlcl9tb2RlbHMoW0ZvcmVzdF0pIl19